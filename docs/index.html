<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>hqsl-ts</title><meta name="description" content="Documentation for hqsl-ts"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">hqsl-ts</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>hqsl-ts</h2></div><div class="tsd-panel tsd-typography"><a id="md:hqsl-parser-and-verifier-in-typescript" class="tsd-anchor"></a><h1><a href="#md:hqsl-parser-and-verifier-in-typescript">HQSL parser and verifier in TypeScript</a></h1><p>See <a href="https://hqsl.net/">HQSL.net</a> for detailed information on what an HQSL is and why would one want to use this.</p>
<p>This is a TypeScript library for parsing, signing, verifying and creating HQSL cards, as used in the HQSL.net card verifier and on <a href="https://hamlog.online/">Hamlog.Online</a>, meant for web use, WebView-based mobile apps, and Node.js.</p>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><pre><code class="language-bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">hqsl-ts</span>
</code><button>Copy</button></pre>
<p>If you&#39;re using TypeScript, you might want to use the TypeScript source code directly instead of the compiled versions:</p>
<pre><code class="language-json"><span class="hl-3">// tsconfig.json</span><br/><span class="hl-1">...</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;paths&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-4">&quot;hqsl-ts&quot;</span><span class="hl-1">: [</span><span class="hl-2">&quot;./node_modules/hqsl-ts/src&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">...</span>
</code><button>Copy</button></pre>
<p>Using this library without a bundler or from a CDN is not currently supported, due to the dependencies involved introducing a significant number of hoops that need jumping. <em>(Pull requests rectifying this situation are welcome.)</em> Since it is assumed you&#39;re using a bundler, no pre-minified versions are included. You can still load, e.g. <code>openpgpjs</code> from CDN, by adding it as an external dependency and using <code>https://cdn.jsdelivr.net/npm/openpgp@5.11.1/dist/openpgp.min.mjs</code> for the URL.</p>
<a id="md:examples" class="tsd-anchor"></a><h2><a href="#md:examples">Examples</a></h2><p>Refer to <a href="docs">API documentation</a> for full details. Here are some brief examples:</p>
<a id="md:creating-a-card-from-adif" class="tsd-anchor"></a><h3><a href="#md:creating-a-card-from-adif">Creating a card from ADIF</a></h3><pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">HQSL</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;hqsl-ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">adif</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">ADIF export from CQRLOG for Linux version 2.5.2, slightly edited.</span><br/><br/><span class="hl-2">&lt;ADIF_VER:5&gt;3.1.0</span><br/><span class="hl-2">&lt;CREATED_TIMESTAMP:15&gt;20240416 114238</span><br/><span class="hl-2">&lt;PROGRAMID:6&gt;CQRLOG</span><br/><span class="hl-2">&lt;PROGRAMVERSION:11&gt;2.5.2 (001)</span><br/><span class="hl-2">&lt;EOH&gt;</span><br/><span class="hl-2">&lt;QSO_DATE:8&gt;20210924&lt;TIME_ON:4&gt;1038&lt;TIME_OFF:4&gt;1039&lt;STATION_CALLSIGN:5&gt;AC1PZ&lt;CALL:6&gt;EA2ESN&lt;MODE:3&gt;FT8&lt;FREQ:7&gt;28.0759&lt;BAND:3&gt;10M&lt;RST_SENT:3&gt;-06&lt;RST_RCVD:3&gt;-13&lt;QSL_SENT:1&gt;N</span><br/><span class="hl-2">&lt;QSL_RCVD:1&gt;N&lt;GRIDSQUARE:6&gt;IN91dv&lt;MY_GRIDSQUARE:6&gt;FN42gv&lt;TX_PWR:2&gt;20</span><br/><span class="hl-2">&lt;EOR&gt;`</span><span class="hl-1">; </span><br/><br/><span class="hl-3">// This parses the ADIF string and supplies defaults for fields not necessarily included.</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">hqsl</span><span class="hl-1"> = </span><span class="hl-8">HQSL</span><span class="hl-1">.</span><span class="hl-0">fromADIF</span><span class="hl-1">(</span><span class="hl-6">adif</span><span class="hl-1">, </span><span class="hl-2">&quot;AC1PZ&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;FN42&quot;</span><span class="hl-1">);</span><br/><span class="hl-3">// The result is every QSO in the ADIF string transformed into an HQSL object:</span><br/><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">hqsl</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-0">toString</span><span class="hl-1">());</span><br/>
</code><button>Copy</button></pre>
<a id="md:creating-a-card-from-scratch-and-signing-it" class="tsd-anchor"></a><h3><a href="#md:creating-a-card-from-scratch-and-signing-it">Creating a card from scratch and signing it</a></h3><pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">HQSL</span><span class="hl-1">, </span><span class="hl-6">HQSLOpenPGP</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;hqsl-ts&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">UTCDateMini</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@date-fns/utc&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">secretKey</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">-----BEGIN PGP PRIVATE KEY BLOCK-----</span><br/><br/><span class="hl-2">lFgEZcSkgRYJKwYBBAHaRw8BAQdA2HVnF04A6dQuF2ID5hh5W7KHRCllqZQHn9kF</span><br/><span class="hl-2">...</span><br/><span class="hl-2">=crTM</span><br/><span class="hl-2">-----END PGP PRIVATE KEY BLOCK-----`</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Here we are creating a card by manually supplying the required data.</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">card</span><span class="hl-1"> = </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">HQSL</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-6">from:</span><span class="hl-1"> </span><span class="hl-2">&quot;AC1PZ&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">to:</span><span class="hl-1"> </span><span class="hl-2">&quot;W1KOT&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">freq:</span><span class="hl-1"> </span><span class="hl-9">14.074</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">where:</span><span class="hl-1"> </span><span class="hl-2">&quot;FN42&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">signal:</span><span class="hl-1"> </span><span class="hl-2">&quot;+00&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">mode:</span><span class="hl-1"> </span><span class="hl-2">&quot;FT8&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">when:</span><span class="hl-1"> </span><span class="hl-7">new</span><span class="hl-1"> </span><span class="hl-0">UTCDateMini</span><span class="hl-1">(</span><span class="hl-9">2022</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-9">13</span><span class="hl-1">, </span><span class="hl-9">16</span><span class="hl-1">, </span><span class="hl-9">10</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// This sets up the signer. Since we&#39;re not verifying anything,</span><br/><span class="hl-1">    </span><span class="hl-3">// we don&#39;t need to supply trusted certifier keys.</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">HQSLOpenPGP</span><span class="hl-1">.</span><span class="hl-0">setup</span><span class="hl-1">([]);</span><br/><span class="hl-1">    </span><span class="hl-3">// Actually sign the card.</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">sign</span><span class="hl-1">(</span><span class="hl-6">card</span><span class="hl-1">, </span><span class="hl-6">signingKey</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">// The result is a signed card body, and we point it at the HQSL.net verifier</span><br/><span class="hl-1">    </span><span class="hl-3">// by attaching the URL header.</span><br/><span class="hl-1">    </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`https://hqsl.net/h#</span><span class="hl-7">${</span><span class="hl-6">card</span><span class="hl-10">.</span><span class="hl-0">toString</span><span class="hl-10">()</span><span class="hl-7">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// If you need to generate a QR code in the browser or in Node.js,</span><br/><span class="hl-1">    </span><span class="hl-3">// the recommended library is</span><br/><span class="hl-1">    </span><span class="hl-3">// tiny-qrcode-svg (https://github.com/withaspoon/tiny-qrcode-svg)</span><br/><span class="hl-1">    </span><span class="hl-3">// because it handles the optimized multi-block QR codes automatically.</span><br/><span class="hl-1">})();</span><br/>
</code><button>Copy</button></pre>
<a id="md:verifying-a-card" class="tsd-anchor"></a><h3><a href="#md:verifying-a-card">Verifying a card</a></h3><pre><code class="language-typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">HQSL</span><span class="hl-1">, </span><span class="hl-6">HQSLOpenPGP</span><span class="hl-1">, </span><span class="hl-6">HQSLState</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&quot;hqsl-ts&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">trustedKey</span><span class="hl-1"> = </span><span class="hl-2">`</span><br/><span class="hl-2">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br/><br/><span class="hl-2">mDMEZbigARYJKwYBBAHaRw8BAQdAJNNtGMTfd6lLFQDhf1Rh2DDqACwQyd1VTF2R</span><br/><span class="hl-2">...</span><br/><span class="hl-2">=D6ih</span><br/><span class="hl-2">-----END PGP PUBLIC KEY BLOCK-----</span><br/><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">card</span><span class="hl-1"> = </span><span class="hl-2">&quot;https://hqsl.net/h#AC1PZ,FN42gv,W1KOT,&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">             </span><span class="hl-2">&quot;202402081323,+00,18.101,FT8,59_05,,&quot;</span><span class="hl-1"> + </span><br/><span class="hl-1">             </span><span class="hl-2">&quot;19H4V9DABY5VH3WE05MV34Z5JBEBJRD9Q7V&quot;</span><span class="hl-1"> + </span><br/><span class="hl-1">             </span><span class="hl-2">&quot;TLB98L789GFL79P56QWFX0JHV3U6VSEXROD&quot;</span><span class="hl-1"> + </span><br/><span class="hl-1">             </span><span class="hl-2">&quot;MYLOZ40UM798EV4FSPVY8YVMQ0WLZA66Q38&quot;</span><span class="hl-1"> + </span><br/><span class="hl-1">             </span><span class="hl-2">&quot;VW0G6PV23O6Y65PK94NZE5B381MHOPR4NJJ&quot;</span><span class="hl-1"> +</span><br/><span class="hl-1">             </span><span class="hl-2">&quot;U67QC25JW85JL23V644BLP0HD8KBY2MODEBRICTZ5C0LC&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-1">(</span><span class="hl-7">async</span><span class="hl-1"> () </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// This gets you a parsed card object.</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">hqsl</span><span class="hl-1"> = </span><span class="hl-8">HQSL</span><span class="hl-1">.</span><span class="hl-0">fromString</span><span class="hl-1">(</span><span class="hl-6">card</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// At this point, you can already access properties on the object, if it got parsed correctly.</span><br/><span class="hl-1">    </span><span class="hl-3">// If it didn&#39;t, the fromString method will throw an error.</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-3">// This sets up the verifier and feeds it the certifier key we trust.</span><br/><span class="hl-1">    </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">HQSLOpenPGP</span><span class="hl-1">.</span><span class="hl-0">setup</span><span class="hl-1">([</span><span class="hl-6">trustedKey</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// This actually adds the verification verdict to the card object.</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1">.</span><span class="hl-0">verify</span><span class="hl-1">(</span><span class="hl-6">hqsl</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// If the card is completely legit, this will print &#39;true&#39;!</span><br/><span class="hl-1">    </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">hqsl</span><span class="hl-1">.</span><span class="hl-6">verification</span><span class="hl-1">.</span><span class="hl-6">verdict</span><span class="hl-1"> == </span><span class="hl-6">HQSLState</span><span class="hl-1">.</span><span class="hl-6">Valid</span><span class="hl-1">)</span><br/><br/><span class="hl-1">})();</span>
</code><button>Copy</button></pre>
<a id="md:tooling" class="tsd-anchor"></a><h2><a href="#md:tooling">Tooling</a></h2><ul>
<li><code>npm run build</code> to build for consumption. This will also build API documentation.</li>
<li><code>npm run test</code> to run unit tests.</li>
<li><code>npm run doc</code> to generate API documentation.</li>
</ul>
<a id="md:license" class="tsd-anchor"></a><h2><a href="#md:license">License</a></h2><p>This library is released under the terms of MIT license. See <a href="LICENSE">LICENSE</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:hqsl-parser-and-verifier-in-typescript"><span>HQSL parser and verifier in <wbr/>Type<wbr/>Script</span></a><ul><li><a href="#md:usage"><span>Usage</span></a></li><li><a href="#md:examples"><span>Examples</span></a></li><li><ul><li><a href="#md:creating-a-card-from-adif"><span>Creating a card from ADIF</span></a></li><li><a href="#md:creating-a-card-from-scratch-and-signing-it"><span>Creating a card from scratch and signing it</span></a></li><li><a href="#md:verifying-a-card"><span>Verifying a card</span></a></li></ul></li><li><a href="#md:tooling"><span>Tooling</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>hqsl-ts</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>